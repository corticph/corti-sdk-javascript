// This file was auto-generated by Fern from our API Definition.

import * as Corti from "../../src/api/index";
import { CortiClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";
import { mockOAuth } from "./mockAuth";

describe("FactsClient", () => {
    test("factGroupsList (1)", async () => {
        const server = mockServerPool.createServer();
        mockOAuth(server);

        const client = new CortiClient({
            maxRetries: 0,
            clientId: "client_id_123",
            clientSecret: "my_secret_value",
            tenantName: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl, login: server.baseUrl, agents: server.baseUrl },
        });

        const rawResponseBody = {
            data: [{ id: "f47ac10b-58cc-4372-a567-0e02b2c3d479", key: "key", translations: [{}] }],
        };
        server.mockEndpoint().get("/factgroups/").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.facts.factGroupsList();
        expect(response).toEqual({
            data: [
                {
                    id: "f47ac10b-58cc-4372-a567-0e02b2c3d479",
                    key: "key",
                    translations: [{}],
                },
            ],
        });
    });

    test("factGroupsList (2)", async () => {
        const server = mockServerPool.createServer();
        mockOAuth(server);

        const client = new CortiClient({
            maxRetries: 0,
            clientId: "client_id_123",
            clientSecret: "my_secret_value",
            tenantName: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl, login: server.baseUrl, agents: server.baseUrl },
        });

        const rawResponseBody = { requestid: "requestid", status: 1, type: "type", detail: "detail" };
        server.mockEndpoint().get("/factgroups/").respondWith().statusCode(500).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.facts.factGroupsList();
        }).rejects.toThrow(Corti.InternalServerError);
    });

    test("list (1)", async () => {
        const server = mockServerPool.createServer();
        mockOAuth(server);

        const client = new CortiClient({
            maxRetries: 0,
            clientId: "client_id_123",
            clientSecret: "my_secret_value",
            tenantName: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl, login: server.baseUrl, agents: server.baseUrl },
        });

        const rawResponseBody = {
            facts: [
                {
                    id: "3c9d8a12-7f44-4b3e-9e6f-9271c2bbfa08",
                    text: "text",
                    group: "other",
                    groupId: "f47ac10b-58cc-4372-a567-0e02b2c3d479",
                    isDiscarded: true,
                    source: "core",
                    createdAt: "2024-01-15T09:30:00Z",
                    updatedAt: "2024-01-15T09:30:00Z",
                    evidence: [{}],
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/interactions/f47ac10b-58cc-4372-a567-0e02b2c3d479/facts/")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.facts.list({
            id: "f47ac10b-58cc-4372-a567-0e02b2c3d479",
        });
        expect(response).toEqual({
            facts: [
                {
                    id: "3c9d8a12-7f44-4b3e-9e6f-9271c2bbfa08",
                    text: "text",
                    group: "other",
                    groupId: "f47ac10b-58cc-4372-a567-0e02b2c3d479",
                    isDiscarded: true,
                    source: "core",
                    createdAt: new Date("2024-01-15T09:30:00.000Z"),
                    updatedAt: new Date("2024-01-15T09:30:00.000Z"),
                    evidence: [{}],
                },
            ],
        });
    });

    test("list (2)", async () => {
        const server = mockServerPool.createServer();
        mockOAuth(server);

        const client = new CortiClient({
            maxRetries: 0,
            clientId: "client_id_123",
            clientSecret: "my_secret_value",
            tenantName: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl, login: server.baseUrl, agents: server.baseUrl },
        });

        const rawResponseBody = { requestid: "requestid", status: 1, type: "type", detail: "detail" };
        server
            .mockEndpoint()
            .get("/interactions/id/facts/")
            .respondWith()
            .statusCode(504)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.facts.list({
                id: "id",
            });
        }).rejects.toThrow(Corti.GatewayTimeoutError);
    });

    test("create (1)", async () => {
        const server = mockServerPool.createServer();
        mockOAuth(server);

        const client = new CortiClient({
            maxRetries: 0,
            clientId: "client_id_123",
            clientSecret: "my_secret_value",
            tenantName: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl, login: server.baseUrl, agents: server.baseUrl },
        });
        const rawRequestBody = { facts: [{ text: "text", group: "other" }] };
        const rawResponseBody = {
            facts: [
                {
                    id: "3c9d8a12-7f44-4b3e-9e6f-9271c2bbfa08",
                    text: "text",
                    group: "other",
                    groupId: "f47ac10b-58cc-4372-a567-0e02b2c3d479",
                    source: "core",
                    isDiscarded: true,
                    updatedAt: "2024-01-15T09:30:00Z",
                },
            ],
        };
        server
            .mockEndpoint()
            .post("/interactions/f47ac10b-58cc-4372-a567-0e02b2c3d479/facts/")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.facts.create({
            id: "f47ac10b-58cc-4372-a567-0e02b2c3d479",
            facts: [
                {
                    text: "text",
                    group: "other",
                },
            ],
        });
        expect(response).toEqual({
            facts: [
                {
                    id: "3c9d8a12-7f44-4b3e-9e6f-9271c2bbfa08",
                    text: "text",
                    group: "other",
                    groupId: "f47ac10b-58cc-4372-a567-0e02b2c3d479",
                    source: "core",
                    isDiscarded: true,
                    updatedAt: new Date("2024-01-15T09:30:00.000Z"),
                },
            ],
        });
    });

    test("create (2)", async () => {
        const server = mockServerPool.createServer();
        mockOAuth(server);

        const client = new CortiClient({
            maxRetries: 0,
            clientId: "client_id_123",
            clientSecret: "my_secret_value",
            tenantName: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl, login: server.baseUrl, agents: server.baseUrl },
        });
        const rawRequestBody = {
            facts: [
                { text: "text", group: "group" },
                { text: "text", group: "group" },
            ],
        };
        const rawResponseBody = { requestid: "requestid", status: 1, type: "type", detail: "detail" };
        server
            .mockEndpoint()
            .post("/interactions/id/facts/")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(504)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.facts.create({
                id: "id",
                facts: [
                    {
                        text: "text",
                        group: "group",
                    },
                    {
                        text: "text",
                        group: "group",
                    },
                ],
            });
        }).rejects.toThrow(Corti.GatewayTimeoutError);
    });

    test("batchUpdate (1)", async () => {
        const server = mockServerPool.createServer();
        mockOAuth(server);

        const client = new CortiClient({
            maxRetries: 0,
            clientId: "client_id_123",
            clientSecret: "my_secret_value",
            tenantName: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl, login: server.baseUrl, agents: server.baseUrl },
        });
        const rawRequestBody = { facts: [{ factId: "3c9d8a12-7f44-4b3e-9e6f-9271c2bbfa08" }] };
        const rawResponseBody = {
            facts: [
                {
                    id: "3c9d8a12-7f44-4b3e-9e6f-9271c2bbfa08",
                    text: "text",
                    group: "other",
                    groupId: "f47ac10b-58cc-4372-a567-0e02b2c3d479",
                    source: "core",
                    isDiscarded: true,
                    createdAt: "2024-01-15T09:30:00Z",
                    updatedAt: "2024-01-15T09:30:00Z",
                },
            ],
        };
        server
            .mockEndpoint()
            .patch("/interactions/f47ac10b-58cc-4372-a567-0e02b2c3d479/facts/")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.facts.batchUpdate({
            id: "f47ac10b-58cc-4372-a567-0e02b2c3d479",
            facts: [
                {
                    factId: "3c9d8a12-7f44-4b3e-9e6f-9271c2bbfa08",
                },
            ],
        });
        expect(response).toEqual({
            facts: [
                {
                    id: "3c9d8a12-7f44-4b3e-9e6f-9271c2bbfa08",
                    text: "text",
                    group: "other",
                    groupId: "f47ac10b-58cc-4372-a567-0e02b2c3d479",
                    source: "core",
                    isDiscarded: true,
                    createdAt: new Date("2024-01-15T09:30:00.000Z"),
                    updatedAt: new Date("2024-01-15T09:30:00.000Z"),
                },
            ],
        });
    });

    test("batchUpdate (2)", async () => {
        const server = mockServerPool.createServer();
        mockOAuth(server);

        const client = new CortiClient({
            maxRetries: 0,
            clientId: "client_id_123",
            clientSecret: "my_secret_value",
            tenantName: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl, login: server.baseUrl, agents: server.baseUrl },
        });
        const rawRequestBody = { facts: [{ factId: "factId" }, { factId: "factId" }] };
        const rawResponseBody = { requestid: "requestid", status: 1, type: "type", detail: "detail" };
        server
            .mockEndpoint()
            .patch("/interactions/id/facts/")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(504)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.facts.batchUpdate({
                id: "id",
                facts: [
                    {
                        factId: "factId",
                    },
                    {
                        factId: "factId",
                    },
                ],
            });
        }).rejects.toThrow(Corti.GatewayTimeoutError);
    });

    test("update (1)", async () => {
        const server = mockServerPool.createServer();
        mockOAuth(server);

        const client = new CortiClient({
            maxRetries: 0,
            clientId: "client_id_123",
            clientSecret: "my_secret_value",
            tenantName: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl, login: server.baseUrl, agents: server.baseUrl },
        });
        const rawRequestBody = {};
        const rawResponseBody = {
            id: "3c9d8a12-7f44-4b3e-9e6f-9271c2bbfa08",
            text: "text",
            group: "other",
            groupId: "f47ac10b-58cc-4372-a567-0e02b2c3d479",
            source: "core",
            isDiscarded: true,
            createdAt: "2024-01-15T09:30:00Z",
            updatedAt: "2024-01-15T09:30:00Z",
        };
        server
            .mockEndpoint()
            .patch("/interactions/f47ac10b-58cc-4372-a567-0e02b2c3d479/facts/3c9d8a12-7f44-4b3e-9e6f-9271c2bbfa08")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.facts.update({
            id: "f47ac10b-58cc-4372-a567-0e02b2c3d479",
            factId: "3c9d8a12-7f44-4b3e-9e6f-9271c2bbfa08",
        });
        expect(response).toEqual({
            id: "3c9d8a12-7f44-4b3e-9e6f-9271c2bbfa08",
            text: "text",
            group: "other",
            groupId: "f47ac10b-58cc-4372-a567-0e02b2c3d479",
            source: "core",
            isDiscarded: true,
            createdAt: new Date("2024-01-15T09:30:00.000Z"),
            updatedAt: new Date("2024-01-15T09:30:00.000Z"),
        });
    });

    test("update (2)", async () => {
        const server = mockServerPool.createServer();
        mockOAuth(server);

        const client = new CortiClient({
            maxRetries: 0,
            clientId: "client_id_123",
            clientSecret: "my_secret_value",
            tenantName: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl, login: server.baseUrl, agents: server.baseUrl },
        });
        const rawRequestBody = {};
        const rawResponseBody = { requestid: "requestid", status: 1, type: "type", detail: "detail" };
        server
            .mockEndpoint()
            .patch("/interactions/id/facts/factId")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(504)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.facts.update({
                id: "id",
                factId: "factId",
            });
        }).rejects.toThrow(Corti.GatewayTimeoutError);
    });

    test("extract (1)", async () => {
        const server = mockServerPool.createServer();
        mockOAuth(server);

        const client = new CortiClient({
            maxRetries: 0,
            clientId: "client_id_123",
            clientSecret: "my_secret_value",
            tenantName: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl, login: server.baseUrl, agents: server.baseUrl },
        });
        const rawRequestBody = { context: [{ type: "text", text: "text" }], outputLanguage: "outputLanguage" };
        const rawResponseBody = {
            facts: [{ group: "group", value: "value" }],
            outputLanguage: "outputLanguage",
            usageInfo: { creditsConsumed: 1.1 },
        };
        server
            .mockEndpoint()
            .post("/tools/extract-facts")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.facts.extract({
            context: [
                {
                    type: "text",
                    text: "text",
                },
            ],
            outputLanguage: "outputLanguage",
        });
        expect(response).toEqual({
            facts: [
                {
                    group: "group",
                    value: "value",
                },
            ],
            outputLanguage: "outputLanguage",
            usageInfo: {
                creditsConsumed: 1.1,
            },
        });
    });

    test("extract (2)", async () => {
        const server = mockServerPool.createServer();
        mockOAuth(server);

        const client = new CortiClient({
            maxRetries: 0,
            clientId: "client_id_123",
            clientSecret: "my_secret_value",
            tenantName: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl, login: server.baseUrl, agents: server.baseUrl },
        });
        const rawRequestBody = {
            context: [
                { type: "text", text: "text" },
                { type: "text", text: "text" },
            ],
            outputLanguage: "outputLanguage",
        };
        const rawResponseBody = { requestid: "requestid", status: 1, type: "type", detail: "detail" };
        server
            .mockEndpoint()
            .post("/tools/extract-facts")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(504)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.facts.extract({
                context: [
                    {
                        type: "text",
                        text: "text",
                    },
                    {
                        type: "text",
                        text: "text",
                    },
                ],
                outputLanguage: "outputLanguage",
            });
        }).rejects.toThrow(Corti.GatewayTimeoutError);
    });
});
